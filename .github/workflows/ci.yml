# .github/workflows/ci.yml
name: CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.x
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run pylint
        run: |
          pylint certcheck || (exit 0)
          pylint_score=$(pylint --exit-zero --reports=n certcheck | awk -F'[/:]' '/Your code has been rated/{print $2}')
          echo "Pylint score is $pylint_score"
          if [[ "$pylint_score" > 9 ]]; then
            echo "Pylint score is greater than 9"
          else
            echo "Pylint score is less than or equal to 9"
            exit 1
          fi
      
  checkov-docker:
    runs-on: ubuntu-latest
    container:
      image: g12m0/testcheckov:latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Run IaC check
        run: checkov -d iac/